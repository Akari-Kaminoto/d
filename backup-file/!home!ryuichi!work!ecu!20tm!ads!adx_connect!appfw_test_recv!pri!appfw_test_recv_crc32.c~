#include <stdint.h>

static uint32_t crc_table[256];

void fpmw_recv_crc32_init()
{
  for(uint32_t i=0; i<256; i++){
    uint32_t c = i << 24;
    for( int j=0; j<8; j++){
      c = ( c << 1) ^ ( ( c & 0x80000000) ? 0x04C11DB7 : 0);
    }
    crc_table[i] = c;
  }
}

uint32_t fpmw_recv_crc32(const void *buf, uint32_t n_bytes)
{
  uint8_t *p = (uint8_t*)buf;
  uint32_t c = 0xffffffff;
  for (uint32_t i = 0; i < n_bytes; ++i) {
      c = (c << 8) ^ crc_table[((c >> 24) ^ p[i]) & 0xff];
  }
  return c;
}
