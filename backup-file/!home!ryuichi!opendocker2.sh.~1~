#!/bin/bash
if [ $# -eq 0 ]; then
    echo You must specify arguments.
    exit
fi

DOCKER_CMD=$(which nvidia-docker)
if [ $? -ne 0 ]; then
    DOCKER_CMD=docker
fi

if [ -d /home/adx/qnx700 ]; then
    QNX_VOLUME="-v /home/adx/qnx700:/qnx700"
fi

${DOCKER_CMD} run --rm -it \
    --sysctl fs.mqueue.msg_max=100 \
    --ulimit msgqueue=8192000 \
    --net=host \
    ${QNX_VOLUME} \
    --device /dev/kvvirtualcan0 --device /dev/kvvirtualcan1 \
    "$@" \
    sh -c "addgroup --gid $(id -g) --force-badname $USER && useradd -g $(id -g) -u $(id -u) -m $USER && su - $USER"
